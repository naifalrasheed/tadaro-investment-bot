version: 1.0
runtime: python311
build:
  commands:
    build:
      - python -m pip install --use-deprecated=legacy-resolver -r requirements.txt
  env:
    - name: PYTHONDONTWRITEBYTECODE
      value: "1"
    - name: PYTHONUNBUFFERED
      value: "1"
run:
  runtime-version: "3.11"
  command: python -m gunicorn app:app --bind 0.0.0.0:8000 --workers 2 --worker-class sync --timeout 120 --access-logfile - --error-logfile - --log-level info
  network:
    port: 8000
    env: PORT
  instance_role_arn: arn:aws:iam::593793060843:role/TadaroAppRunnerInstanceRole
  env:
    # Non-sensitive environment variables (safe to put here)
    - name: FLASK_APP
      value: app.py
  secrets:
    # Sensitive data - ARN references to AWS Secrets Manager
    - name: CLAUDE_API_KEY
      value-from: "arn:aws:secretsmanager:us-east-1:593793060843:secret:tadaro-investment-bot/claude-api-key"
    - name: DATABASE_URL
      value-from: "arn:aws:secretsmanager:us-east-1:593793060843:secret:tadaro-investment-bot/database-url"
    - name: GOOGLE_CLIENT_SECRET
      value-from: "arn:aws:secretsmanager:us-east-1:593793060843:secret:tadaro-investment-bot/google-client-secret"
    - name: SECRET_KEY
      value-from: "arn:aws:secretsmanager:us-east-1:593793060843:secret:tadaro-investment-bot/flask-secret-key"
    - name: TWELVEDATA_API_KEY
      value-from: "arn:aws:secretsmanager:us-east-1:593793060843:secret:tadaro-investment-bot/twelvedata-api-key"
    # Non-sensitive parameters from Parameter Store
    - name: GOOGLE_CLIENT_ID
      value-from: "arn:aws:ssm:us-east-1:593793060843:parameter/tadaro-investment-bot/google-client-id"
    - name: FLASK_ENV
      value-from: "arn:aws:ssm:us-east-1:593793060843:parameter/tadaro-investment-bot/flask-env"
    - name: PORT
      value-from: "arn:aws:ssm:us-east-1:593793060843:parameter/tadaro-investment-bot/port"